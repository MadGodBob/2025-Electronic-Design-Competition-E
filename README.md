# 2025电赛E题简易自行瞄准装置解决方案

### 主要硬件

- ​	LP-MSPM0G3507
- ​    OPENMV4 H7 PLUS
- ​    张大头42步进闭环电机
- ​    十二路灰度传感器
- ​    JY901S陀螺仪

### 开发环境

- ​	keil

### OPENMV例程说明

​		包含灰度处理和RGB处理两种例程，大致思路为获取图像中的黑色色块，获取黑色色块中的白色色块，计算俩色块的中心点并人为加上偏置得到圆心坐标

### 主体思路

- ​		M0控制巡线、电机、二维云台，OPENMV只识别矩阵坐标并发送
- ​        打靶时读取陀螺仪数据，将其施加到步进电机上，使云台始终朝向一个方向。并且云台轮询率越高，效果越好（取决于程序速度）
- ​        对小车进行空间解算，建立笛卡尔坐标系，求解其与标靶的夹角并施加到云台控制上，使云台始终面向标靶（前馈PID）。笛卡尔坐标系具体为：标靶正下方为原点，标靶平面往左为x轴正方向，垂直于标靶向后为y轴正方向（此时正视标靶）
- ​        对夹角解算进行卡尔曼滤波，减少跳变

### 硬件相关配置

- ​		张大头42闭环步进电机配置方法：[Emm_V5.0步进闭环驱动说明书Rev1.3_emm42v5-CSDN博客](https://blog.csdn.net/zhangdatou666/article/details/132644047)。其它配置默认，重要配置为：
  - **MotType**:1.8°
  - **P_Pul**:PUL_FOC
  - **P_Serial**:UART_FUN
  - **En**:Hold
  - **Dir**:CW(方向自定)
  - **MStep**:64
  - **Ma_Limit**:2000
  - **Op_Limit**:2000
  - **UartBaud**:115200
  - **ID_Addr**:1(两个电机分别为1和2)
  - **S_Vel_IS**:Enable(精度更高)
- ​        JY901S配置简单，波特率**115200**以及回传方式设置为**单次**即可		

### 问题与解决

1. 普通舵机如270°舵机无法旋转一周的问题：使用360°舵机；改装270°舵机（本质为直流电机），但精度差；使用步进电机
2. 步进电机云台很重，若安装在车辆头部可能将导致后轮失去抓地力：使用橡胶胎
3. 云台与电机同时运作时可能出现供电不足：使用两块电池分别供电，即整个瞄准系统使用单独的开关和单独的电池，与M0控制系统隔开。同时两个系统需要共地，确保串口的正常通信
4. 两个步进电机无法使用一根TX线通信：尝试无果，果断使用两个串口分别通信
5. 线缠绕：自制更长的线，使用特制线（如XH2.54），杜绝杜邦线
6. M0中断难用、混用、紊乱：M0一共四个串口，四个TX和四个RX。两个电机使用两个TX，JY901S使用一个TX一个RX，OPENMV使用一个TX一个RX。同时JY901S设置模式为“单次”，M0发送数据请求，JY901S才返回数据，这样串口中断几乎都由OPENMV的串口承担